Private Sub CommandButton1_Click()

    ' Define worksheet reference
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim tradeDate As String
    Dim timeElapsedFormula As String
    Dim adjustmentFormula As String

    Set ws = ThisWorkbook.Sheets("Sheet1") ' Change "Sheet1" to your actual sheet name

    ' Get the trade date from the text box
    tradeDate = Me.TextBox3.Value    ' Trade Date from TextBox3

    ' Find the last row in column B and add new data 3 rows below
    lastRow = ws.Cells(ws.Rows.Count, 2).End(xlUp).Row

    ' Insert data into the worksheet
    ws.Cells(lastRow + 3, 2).Value = "TRADE ID"          ' Title in column B
    ws.Cells(lastRow + 3, 3).Value = Me.TextBox1.Value    ' Value from TextBox1 (Trade ID) in column C

    ' Insert the Valuation Date as a reference to H1
    ws.Cells(lastRow + 4, 2).Value = "Valuation Date"     ' Title in column B
    ws.Cells(lastRow + 4, 3).Formula = "=H1"              ' Reference to cell H1 for Valuation Date

    ws.Cells(lastRow + 5, 2).Value = "Trade Date"         ' Title in column B
    ws.Cells(lastRow + 5, 3).Value = Me.TextBox3.Value    ' Value from TextBox3 (Trade Date) in column C

    ws.Cells(lastRow + 6, 2).Value = "Day 1 P&L"          ' Title in column B
    ws.Cells(lastRow + 6, 3).Value = Me.TextBox4.Value    ' Value from TextBox4 (Day 1 P&L) in column C

    ' Insert the Time Elapsed formula
    ' =((Valuation Date - Trade Date)/365)*12
    timeElapsedFormula = "=((C" & (lastRow + 4) & " - C" & (lastRow + 5) & ")/365)*12"
    ws.Cells(lastRow + 7, 2).Value = "Time Elapsed"       ' Title in column B
    ws.Cells(lastRow + 7, 3).Formula = timeElapsedFormula ' Insert Time Elapsed formula in column C

    ' Insert the Adjustment formula
    ' =MAX(0, Day 1 P&L * (12 - Time Elapsed) / 12)
    adjustmentFormula = "=MAX(0, C" & (lastRow + 6) & " * (12 - C" & (lastRow + 7) & ") / 12)"
    ws.Cells(lastRow + 8, 2).Value = "Adjustment"         ' Title in column B
    ws.Cells(lastRow + 8, 3).Formula = adjustmentFormula  ' Insert Adjustment formula in column C

    ' Clear the text boxes after submission
    Me.TextBox1.Value = ""
    Me.TextBox2.Value = ""
    Me.TextBox3.Value = ""
    Me.TextBox4.Value = ""
    Me.TextBox5.Value = "" ' Clear calculated Time Elapsed (not needed in form anymore)
    Me.TextBox6.Value = "" ' Clear calculated Adjustment (not needed in form anymore)

End Sub
